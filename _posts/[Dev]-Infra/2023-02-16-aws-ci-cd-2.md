---
title: "[AWS] - Spring Boot í”„ë¡œì íŠ¸ ë°°í¬(2)"
last_modified_at: 2023-02-16T21:00:37-21:30
categories: "[Dev]-Infra"
tags:
  - SpringBoot
  - NGINX
  - AWS EC2
  - Gabia
  - Certbot/SSL
toc: true
toc_sticky: true
toc_label: "Spring CI/CD"
toc_icon: "file"
---
## ê°œë°œ í™˜ê²½

ğŸ’» OS : M1 Mac Ventura 13.1 / EC2 Amazon Linux

ğŸƒ Spring : Spring Boot 2.7.7

ğŸ­ Env : Gabia(ê°€ë¹„ì•„), Nginx, Certbot/SSL

## Gabia

### ë„ë©”ì¸ êµ¬ë§¤

ì•ìœ¼ë¡œ DNSë¥¼ ì‚¬ìš©í•  ê²ƒì´ê¸° ë•Œë¬¸ì—, ê°€ë¹„ì•„ì— ë“¤ì–´ê°€ ë„ë©”ì¸ì„ êµ¬ë§¤í•˜ì!

<img width="1220" alt="image" src="https://user-images.githubusercontent.com/82663161/219635728-9ee6c8ca-ca12-4358-8c4c-0800b4e0fdc2.png">

- ë³¸ì¸ì´ ì›í•˜ëŠ” ë„ë©”ì¸ì„ ê²€ìƒ‰í•œ ë’¤, ì‹ ì²­
- êµ¬ë§¤ ê³¼ì •ì—ì„œ ë”°ë¡œ ê±´ë“¤ì´ëŠ” ê²ƒ ì—†ì´ êµ¬ë§¤!

<img width="1213" alt="image" src="https://user-images.githubusercontent.com/82663161/219637372-92bb4906-824f-406d-be03-dc6aaef5abad.png">

### ë„ë©”ì¸ ì„¤ì •

- ë©”ì¸í™”ë©´ ìš°ì¸¡ ìƒë‹¨ì— ìˆëŠ” Myê°€ë¹„ì•„ ë²„íŠ¼ í´ë¦­
- ë°©ê¸ˆ êµ¬ë§¤í•œ ë„ë©”ì¸ì˜ ê´€ë¦¬ ë²„íŠ¼ í´ë¦­

<img width="1424" alt="image" src="https://user-images.githubusercontent.com/82663161/219637803-0894c80d-f39c-495c-a160-b1cd422df944.png">

- DNS ì •ë³´ íƒ­ì— ë“¤ì–´ê°€ì„œ DNS ê´€ë¦¬ ë²„íŠ¼ í´ë¦­

<img width="1430" alt="image" src="https://user-images.githubusercontent.com/82663161/219639062-f9a695f4-46f4-4d25-9228-909fe3acfe6a.png">

- ë°©ê¸ˆ êµ¬ë§¤í•œ ë„ë©”ì¸ì˜ ê°€ì¥ ìš°ì¸¡ ì„¤ì • ë²„íŠ¼ í´ë¦­

<img width="1420" alt="image" src="https://user-images.githubusercontent.com/82663161/219640146-ab956924-e50a-431c-b680-6ad76e420b13.png">

- ì‚¬ì§„ê³¼ ê°™ì´ ë ˆì½”ë“œ ìˆ˜ì •ì„ ëˆŒëŸ¬ í¸ì§‘
- `www`, `@` ì´ 2ê°œì˜ í˜¸ìŠ¤íŠ¸ë¥¼ ê°ê° ì§€ì •í•´ì¤€ë’¤, `TTL`ì€ 3600ìœ¼ë¡œ ì§€ì •í•´ì¤€ë‹¤.
- ê°’/ìœ„ì¹˜ëŠ” EC2ì˜ í¼ë¸”ë¦­ IPv4(íƒ„ë ¥ì  IP)ë¥¼ ì…ë ¥í•´ì£¼ë©´ ëœë‹¤.

> ì ìš©ê¹Œì§€ ìµœëŒ€ 10ë¶„ì´ ê±¸ë¦´ ìˆ˜ ìˆìœ¼ë©°, ì‹ ì²­í•œ ë„ë©”ì¸ìœ¼ë¡œ ì ‘ì† ì‹œ EC2ì— ë°°í¬ë˜ì–´ ìˆëŠ” ì„œë²„ì— ì ‘ì†í•  ìˆ˜ ìˆê²Œ ëœë‹¤.

## Nginx

`Amazon Linux(EC2)`ì— `ssh`ë¡œ ì ‘ê·¼í•´ì„œ ì•„ë˜ ê³¼ì •ì„ ì§„í–‰!

### Nginx ì„¤ì¹˜

<center>
  <img width="773" alt="image" src="https://user-images.githubusercontent.com/82663161/219643574-0f1cbe1d-8e78-4035-ac7f-b48328e8fb22.png">
</center>

```shell
sudo amazon-linux-extras install -y nginx1

nginx -v
```

### config íŒŒì¼ ìˆ˜ì •

<center>
  <img width="787" alt="image" src="https://user-images.githubusercontent.com/82663161/219644817-240e6581-cb89-4c97-bc3f-20368882ee1b.png">
</center>

```shell
sudo vi /etc/nginx/nginx.conf
```

ì—¬ê¸°ì„œ server_name ë¶€ë¶„ì— ê°€ë¹„ì•„ì—ì„œ êµ¬ë§¤í•œ ë„ë©”ì¸ì„ ì…ë ¥í•´ì¤€ë‹¤.

### Certbot/SSL

https ë³´ì•ˆì„ ì‚¬ìš©í•˜ê¸° ìœ„í•´ì„œëŠ” SSL ì¸ì¦ì„œê°€ í•„ìš”í•˜ë‹¤.<br>
ì•„ë˜ ê³¼ì •ì„ í†µí•´ SSL ì¸ì¦ì„œë¥¼ ë°œê¸‰ ë°›ê³ , ì ìš©í•´ë³´ë„ë¡ í•˜ì!

```shell
sudo wget -r --no-parent -A 'epel-release-*.rpm' http://dl.fedoraproject.org/pub/epel/7/x86_64/Packages/e/

sudo rpm -Uvh dl.fedoraproject.org/pub/epel/7/x86_64/Packages/e/epel-release-*.rpm

sudo yum-config-manager --enable epel*

sudo yum install -y certbot python2-certbot-apache

sudo yum install certbot-nginx
```

ë„¤íŠ¸ì›Œí¬ì— ë¬¸ì œê°€ ìˆì§€ ì•Šì€ ì´ìƒ ìœ„ ë‚´ìš©ì—ì„œ ì—ëŸ¬ê°€ ë‚  ì¼ì€ ì—†ì„ ê²ƒì´ë‹¤.

```shell
sudo certbot --nginx
```

ëª¨ë“  ì„¤ì¹˜ê°€ ì™„ë£Œë˜ë©´, ìœ„ ëª…ë ¹ì–´ë¥¼ í†µí•´ ì¸ì¦ì„œë¥¼ ë°œê¸‰!

- ì²˜ìŒì— ë‚˜ì˜¤ëŠ” email ì…ë ¥ì€ í•„ìˆ˜ë¡œ ê¸°ì–µ
- ëª¨ë‘ `Y`ë¥¼ ì…ë ¥í•´ ë™ì˜í•´ì£¼ë„ë¡ í•œë‹¤!
  - í™ë³´ì„± ì´ë©”ì¼ ìˆ˜ì‹  ì—¬ë¶€ëŠ” `N`ì„ í•´ë„ ìƒê´€ ì—†ìŒ!

### Proxy

```shell
sudo vi /etc/nginx/nginx.conf
```

- conf íŒŒì¼ì„ ìˆ˜ì •í•˜ê¸° ìœ„í•´ ìœ„ ëª…ë ¹ì–´ ì…ë ¥

```shell
location / {
       proxy_pass http://localhost:8080; # ìì‹ ì˜ springboot appì´ì‚¬ìš©í•˜ëŠ” í¬íŠ¸
       proxy_set_header Host $host;
       proxy_set_header X-Real-IP $remote_addr;
       proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
       proxy_set_header X-Forwarded-Proto $scheme;
}
```

ìœ„ì˜ ë‚´ìš©ì„ ì´ ë‘ ê³³ì— ë“±ë¡í•  ê²ƒì´ë‹¤.

<center>
  <img width="787" alt="image" src="https://user-images.githubusercontent.com/82663161/219648113-f5cd0101-9354-4ac7-a1ac-7561f1450c74.png">
</center>

<center>
  <img width="743" alt="image" src="https://user-images.githubusercontent.com/82663161/219648452-42b2bb0a-b00d-488e-9013-d0e6ff2da39d.png">
</center>

```shell
# nginxì— ë¬¸ì œê°€ ì—†ëŠ”ì§€ í…ŒìŠ¤íŠ¸
sudo nginx -t

# nginx ì„œë¹„ìŠ¤ ì¬ì‹œì‘
sudo service nginx restart
```